<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<link rel="stylesheet"
	href="bower_components/bootstrap/dist/css/bootstrap.min.css">
<link rel="stylesheet"
	href="bower_components/bootstrap/dist/css/bootstrap-theme.min.css">
<link rel="stylesheet" href="css/menu.css" type="text/css">
<script type="text/javascript" src="js/menu.js"></script>

<title>Free Riding</title>
<style>
.col-xs-5 {
  margin-left: 80px;
}
p {
  margin-bottom: 0px;
  margin-top:10px;
  padding-bottom: 0px;
  font-weight: bold;
}
#map {
  margin-top: 50px;
}
.profile {
	border-radius: 80%;
	width: 40px;
	height: 40px;
	cursor: pointer;
}

.profilename {
	margin-left: 50px;
}

#changeBtn, #deleteBtn, #joinBtn, #list {
  margin-right: 20px;
}

th {
  font-size: 15px;
}

td {
  font-weight:lighter;
}
</style>
</head>

<body onload="menuinit();">
	<header>
		<span><object id="mainbike" data="img/main.swf"
				onclick="location.href='main.html'"></object></span>

		<div class="upmenu">
			<span><img id="home" src="img/b1.JPG"
				onclick="location.href='main.html'"></span> <span id="login"
				onclick="location.href='login.html'">login</span> <span id="logout"
				onclick="location.href='auth/logout.do'">logout</span>
			<li id="menu1" onmouseover="subMenuOpenBox('menu1','sub1')"
				onmouseout="subMenuCloseBox('menu1','sub1')">MY RIDING
				<div id="sub1" float="left">
					<ul>
						<li id="s1l1" onclick="location.href='myInfo.html'">MY INFO</a></li>
						<li id="s1l2" onclick="location.href='myList.html'">MY RIDING
							LIST</li>
					</ul>
				</div>
			</li>
			<li id="menu2" onmouseover="subMenuOpenBox('menu2','sub2')"
				onmouseout="subMenuCloseBox('menu2','sub2')">RIDING
				<div id="sub2" float="left">
					<ul>
						<li id="s2l1" onclick="location.href='freeLocation.html'">FREE
							RIDING</a>
						</li>
						<li id="s2l2" onclick="location.href='guideLocation.html'">GUIDE
							RIDING</a>
						</li>
					</ul>
				</div>
			</li>
			<div id="menu3" onmouseover="subMenuOpenBox('menu3','sub3')"
				onmouseout="subMenuCloseBox('menu3','sub3')"
				onclick="location.href='course.html'">
				COURSE
				<div id="sub3" float="left"></div>
			</div>
		</div>
		<br> <br>
	</header>


			<center>
				<img class="profile" src="img/4.jpg" align="left">
				<p class="profilename" align="left">KyeongHun-Min</p>
			</center>

			<h2 align="center">Free Riding</h2>
			<hr width=100px margin-top=0px>

			<div class="col-xs-5">
		  	<p>작성자</p>
				<input id="writer" class="form-control" type="text" placeholder=""
					disabled>
				<p>제목</p><input id="title" type="text" class="form-control"  disabled>
				<p>장소</p><input id="mloca" type="text" class="form-control" disabled>
				<p>날짜</p><input id="mday" type="text" class="form-control" disabled>
				<p>시간</p><input id="mtime" type="text" class="form-control" disabled>
				<p>총거리</p><input id="distance" type="text" class="form-control" disabled>
				<p>예상 소요시간</p><input id="time" type="text" class="form-control" disabled>
				<p>모집인원</p><input id="pnum" type="text" class="form-control" disabled>
				<p>연락처</p><input id="ph" type="text" class="form-control" disabled>
      </div>
      
        <div id="map" style="width: 500px; height: 540px;">
					<script type="text/javascript"
						src="//apis.daum.net/maps/maps3.js?apikey=abd3c171a7ac3dd4f40ddff3e12ac79b"></script>
				</div><br>

				<div>
					<button id="changeBtn" type="button"
						class="btn btn-default btn pull-right">UPDATE</button>
				</div>
				<div>
					<button id="deleteBtn" type="button"
						class="btn btn-default btn pull-right">DELETE</button>
				</div>
				<div>
          <button id="joinBtn" 
            class="btn btn-default btn pull-right"><span id='j'>JOIN</span></button>
        </div>
        
				  <!-- Button trigger modal -->
				<button id="list" type="submit" class="btn btn-default btn pull-right" data-toggle="modal" data-target="#myModal">
				  JOIN LIST
				</button>
	
	<!-- Modal -->
	<form>
				<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
				  <div class="modal-dialog" role="document">
				    <div class="modal-content">
				      <div class="modal-header">
				        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				        <h4 class="modal-title" id="myModalLabel">Join List</h4>
			        </div>
	        
			        <div id="md" class="modal-body">
			        
			        
			          <table class="table table-condensed">
								<thead>
									<tr>
										<th>이름</th>
										<th>성별</th>
										<th>포지션</th>
									</tr>
								</thead>
			
								<tbody>
								</tbody>
								</table>
							
								
		         	</div>
				         	
				      <div class="modal-footer">
				        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
				      </div>
				    </div>
				  </div>
				</div>
				</form>

<script src="bower_components/moment/moment.js"></script>
<script src="bower_components/jquery/dist/jquery.js"></script>
<script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="bower_components/handlebars/handlebars.min.js"></script>
<script type="text/javascript" src="js/menu.js"></script>
<script type="text/javascript">
$.extend({
    getUrlVars: function(){
        var vars = [], hash;
        var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
        for(var i = 0; i < hashes.length; i++) {
            hash = hashes[i].split('=');
            vars.push(hash[0]);
            vars[hash[0]] = hash[1];
        }
        return vars;
    },
    getUrlVar: function(name) {
        return $.getUrlVars()[name];
    }
});

var no = $.getUrlVar('no');
var ploca = $.getUrlVar('loca');
var prbtype = $.getUrlVar('rbtype');

$.getJSON("ajax/board/detail.do?no=" + no, function(result) {
	
	  var board = result.board;
	  $("#writer").val(board.mnm);
    $("#title").val(board.title);
    $("#mloca").val(board.mloca);
    $("#mday").val(moment(board.mday, 'MM/DD/YYYY').format().substr(0,10));
    $("#mtime").val(board.mtime);
    $("#distance").val(board.distance);
    $("#time").val(board.time);
    $("#pnum").val(board.pnum);
    $("#ph").val(board.ph);
    if (result.status == "fail") {
    	  $("#deleteBtn").css("display","none");
    	  $("#changeBtn").css("display","none");
     }
});
$.getJSON("ajax/board/isJoin.do?no=" + no, function(result) {
    if (result.status == "yes") {
    	document.getElementById("j").textContent="DISJOIN";
    }else if (result.status == "no") {
      document.getElementById("j").textContent="JOIN";
    }
});

$.getJSON("ajax/member/memberList.do?bno=" + no, function(result) {
    var member = result.list;
    var tbody = $("tbody");
    for (var i in member) {
      $("<tr>")
        .html(
          "<td>" + member[i].name + "</td>" +
          "<td>" + member[i].gender + "</td>" +
          "<td>" + member[i].position +"</td>")
        .appendTo(tbody);
    }
});

$("#deleteBtn").click(function(event) {
	  $.getJSON("ajax/board/delete.do?no=" + no, function(result) {
	      if (result.status == "success") {
	        location.href = "freeRiding.html?loca="+ploca+"&rbtype="+prbtype;
	      } else{
	        window.alert("삭제 실패입니다!");
	      }
	  });
});  

$("#changeBtn").click(function(event) {
   	location.href = "freeUpdate.html?no="+no+"&loca="+ploca+"&rbtype="+prbtype;
});

$("#joinBtn").click(function(event) {
	$.getJSON("ajax/board/join.do?no=" + no, function(result) {
        if (result.status == "success") {
        	window.alert("참여 하였습니다!");
        	document.getElementById("j").textContent="DISJOIN";
        	$("tbody").empty();
        	$.getJSON("ajax/member/memberList.do?bno=" + no, function(result) {
        	    var member = result.list;
        	    var tbody = $("tbody");
        	    for (var i in member) {
        	      $("<tr>")
        	        .html(
        	          "<td>" + member[i].name + "</td>" +
        	          "<td>" + member[i].gender + "</td>" +
        	          "<td>" + member[i].position +"</td>")
        	        .appendTo(tbody);
        	    }
        	});
        } else if (result.status == "cancel") {
          window.alert("참여 취소했습니다!");
          document.getElementById("j").textContent="JOIN";
          $("tbody").empty();
          $.getJSON("ajax/member/memberList.do?bno=" + no, function(result) {
              var member = result.list;
              var tbody = $("tbody");
              for (var i in member) {
                $("<tr>")
                  .html(
                    "<td>" + member[i].name + "</td>" +
                    "<td>" + member[i].gender + "</td>" +
                    "<td>" + member[i].position +"</td>")
                  .appendTo(tbody);
              }
          });
        } else{
          window.alert("참여 실패입니다!");
        }
    });
});

$('#myModal').on('shown.bs.modal', function () {
	  $('#myInput').focus()
	});

//////////////////map load////////////////// 
var drawingFlag = false; // 선이 그려지고 있는 상태를 가지고 있을 변수입니다
var moveLine; // 선이 그려지고 있을때 마우스 움직임에 따라 그려질 선 객체 입니다
var distanceOverlay; // 선의 거리정보를 표시할 커스텀오버레이 입니다
var dots = {}; // 선이 그려지고 있을때 클릭할 때마다 클릭 지점과 거리를 표시하는 커스텀 오버레이 배열입니다.
$.getJSON("ajax/board/getMap.do?no="+no, function(result) {
	      var list = result.list;
	      var clickLine = new daum.maps.Polyline({
	            map : map, // 선을 표시할 지도입니다 
	            path : [], // 선을 구성하는 좌표 배열입니다 클릭한 위치를 넣어줍니다
	            strokeWeight : 3, // 선의 두께입니다 
	            strokeColor : '#db4040', // 선의 색깔입니다
	            strokeOpacity : 1, // 선의 불투명도입니다 0에서 1 사이값이며 0에 가까울수록 투명합니다
	            strokeStyle : 'solid' // 선의 스타일입니다
	          });
	      var linepath = clickLine.getPath();
				if (result.status == "success") {
					var mapContainer = document.getElementById('map'), // 지도를 표시할 div  
          mapOption = { 
              center: new daum.maps.LatLng(33.450701, 126.570667), // 지도의 중심좌표
              level: 3 // 지도의 확대 레벨
          };
          var map = new daum.maps.Map(mapContainer, mapOption); // 지도를 생성합니다
			          
					for ( var i in list) {
						console.log(i);
						
						if(i == 0) {
							var startSrc = 'http://i1.daumcdn.net/localimg/localimages/07/mapapidoc/red_b.png'; // 출발 마커이미지의 주소입니다    
							var startSize = new daum.maps.Size(50, 45); // 출발 마커이미지의 크기입니다 
							var startMarker = new daum.maps.Marker({
								  map : map, // 출발 마커가 지도 위에 표시되도록 설정합니다
									position : new daum.maps.LatLng(list[i].bb, list[i].ab),
									image : new daum.maps.MarkerImage(startSrc, startSize)
									// 출발 마커이미지를 설정합니다
									});
						}

								linepath.push(new daum.maps.LatLng(list[i].bb, list[i].ab));
					}
          
				  if (i == (list.length-1)) {
					  var arriveSrc = 'http://i1.daumcdn.net/localimg/localimages/07/mapapidoc/blue_b.png'; // 도착 마커이미지 주소입니다    
					  var arriveSize = new daum.maps.Size(50, 45); // 도착 마커이미지의 크기입니다 
					  
					// 도착 마커를 생성합니다 
						var arriveMarker = new daum.maps.Marker({  
						    map: map, // 도착 마커가 지도 위에 표시되도록 설정합니다
						    position: new daum.maps.LatLng(list[i].bb, list[i].ab),
						    draggable: true, // 도착 마커가 드래그 가능하도록 설정합니다
						    image: new daum.maps.MarkerImage(arriveSrc, arriveSize) // 도착 마커이미지를 설정합니다
						});
				  }

					clickLine.setPath(linepath);
					clickLine.setMap(map);
				} else if (result.status == "failure") {
					window.alert("불러오기 실패입니다!");
					}
});
</script>
</body>
</html>